version: "3.5"

services:
  mosquitto:
    image: eclipse-mosquitto
    deploy:
      replicas: 1
    configs:
      - source: mosquitto_config
        target: /mosquitto/config/mosquitto.conf
    networks:
      mqtt:
        aliases:
          - mqtt
    expose:
      - "1883"
    ports:
      - "1883:1883"
      - "8883:8883"

  fronius-mqtt:
    image: enkiusz/fronius-mqtt:latest
    deploy:
      replicas: 1
    environment:
      DATAMANAGER_URL: http://pv.shill.gq
      BROKER_URL: mqtt://mqtt
    networks:
      - mqtt
      - bridge
    depends_on:
      - mosquitto

configs:
  mosquitto_config:
    file: conf/mosquitto.conf

networks:
  mqtt:
    internal: true
  bridge:
    external: true
